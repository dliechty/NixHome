_sshaws()
{
    local cur prev opts
    COMPREPLY=()
    cur="${COMP_WORDS[COMP_CWORD]}"
    prev="${COMP_WORDS[COMP_CWORD-1]}"
    opts=$(cat ~/.ssh/aws_hosts | sed -e 's///g')

    COMPREPLY=( $(compgen -W "$opts" -- ${cur}) )
    return 0
}
complete -F _sshaws sshaws
complete -F _sshaws ssha
complete -F _sshaws sshap
complete -F _sshaws uvimrc
complete -F _sshaws register_node

complete -o nospace -F _scp scpaws

if command -v docker > /dev/null 2>&1
then
    _completion_loader docker
fi


# Bash tab completion function that lists all running containers
__docker_running_containers() {
    local cur prev containers
    cur="${COMP_WORDS[COMP_CWORD]}"
    prev="${COMP_WORDS[COMP_CWORD-1]}"

    containers=$(docker ps --format "{{.Names}}")

    COMPREPLY=($(compgen -W "$containers" -- "$cur"))
}

# Bash tab completion function that lists all images
__docker_images() {
    local cur prev containers
    cur="${COMP_WORDS[COMP_CWORD]}"
    prev="${COMP_WORDS[COMP_CWORD-1]}"

    images=$(docker images --format "{{.Repository}}")

    COMPREPLY=($(compgen -W "$images" -- "$cur"))
}


# set up function dbash including tab completion to start a bash shell in a running docker image
if command -v docker > /dev/null 2>&1
then
    function dbash() { docker exec -it "$1" bash; }
    function dexec() { docker exec -it "$@"; }
    complete -F __docker_running_containers dbash
    complete -F __docker_running_containers dexec
fi

# Set up tab completion for docker/ngs install scripts
if command -v ~/work/docker/install.sh > /dev/null 2>&1
then
    complete -F __docker_images install.sh
fi
